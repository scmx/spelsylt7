var Nt=Object.defineProperty;var St=(o,t,e)=>t in o?Nt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var u=(o,t,e)=>(St(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class At{constructor(){u(this,"keys",{...D});u(this,"onKeydown",t=>{for(const[e,n]of W)n.has(t.code)&&(this.keys[e]=!0)});u(this,"onKeyup",t=>{for(const[e,n]of W)n.has(t.code)&&(this.keys[e]=!1)});u(this,"onBlur",()=>{this.keys={...D}});addEventListener("keydown",this.onKeydown),addEventListener("keyup",this.onKeyup),addEventListener("blur",this.onBlur)}}const D={up:!1,left:!1,down:!1,right:!1,space:!1,shift:!1},W=new Map([["up",new Set(["ArrowUp","KeyW"])],["left",new Set(["ArrowLeft","KeyA"])],["down",new Set(["ArrowDown","KeyS"])],["right",new Set(["ArrowRight","KeyD"])],["space",new Set(["Space"])],["shift",new Set(["ShiftLeft","ShiftRight"])]]);class lt{constructor({x:t,y:e}){u(this,"state",z.idle);u(this,"skin",C(Lt));u(this,"hair",C(jt));u(this,"facing",C(It));u(this,"top",C(Ot));u(this,"bottom",C(Pt));u(this,"shoes",C(Ct));u(this,"frame",{x:0,timer:0,interval:1e3/8});u(this,"images",[]);u(this,"speed",1);u(this,"xmov",0);u(this,"ymov",0);u(this,"pos");u(this,"accessory");u(this,"tool");this.pos={x:t,y:e},Math.random()<.2&&(this.accessory=dt.tie_red),this.loadImages()}update(t,e){this.updateFrame(t)}updateFrame(t,{idleStill:e}={}){this.frame.timer<this.frame.interval?this.frame.timer+=t:(this.frame.timer=0,this.frame.x=e&&this.state===z.idle?0:(this.frame.x+1)%Et[this.state])}move(t,e=this.speed){if(this.xmov||this.ymov){const n=Math.atan2(this.ymov,this.xmov);this.state=e>.5?z.run:z.walk,this.facing=Kt(this.xmov,this.ymov),this.pos.x+=Math.cos(n)*e*t*.003,this.pos.y+=Math.sin(n)*e*t*.003}else this.state!==z.idle&&(this.state=z.idle,this.frame.x=0);this.loadImages()}draw(t,e){const{tile:n}=e.canvas,i=e.resolve(this.pos),{frame:s}=this,r=n*4,h=r/2,c=r/8;for(const a of this.images)a.dataset.still?t.drawImage(a,i.x,i.y,c,c):t.drawImage(a,s.x*64,this.facing*64,64,64,i.x-h,i.y-h,r,r)}loadImages(){Ft(this).then(t=>{this.images=t})}getSprite(){const{x:t,y:e}=this.pos,n=32;return{min:{x:t-n,y:e-n},max:{x:t+n,y:e+n}}}}var z=(o=>(o.idle="idle",o.jump="jump",o.run="run",o.walk="walk",o))(z||{}),dt=(o=>(o.tie_red="tie_red",o))(dt||{});const Ot=["overhalls","shirt_green","shirt_white"],Pt=["jeans","khakis"],Ct=["black","brown","red","yellow"],X=new Map;async function Ft(o){const{state:t,skin:e,hair:n,top:i,bottom:s,shoes:r,accessory:h,tool:c}=o,a=n.split("_")[0];async function l(d,m={}){let g=X.get(d);return g||(g=new Promise((M,k)=>{const _=new Image;_.src=`/spelsylt7/assets/${d}`,_.onload=()=>M(_),_.onerror=F=>{console.error(m);debugger;k(F)},m.still&&(_.dataset.still="1")}),X.set(d,g),g)}const f=[l(`character/adult/body/${t}/${t}_${e}_skintone.png`),l(`character/adult/hairs/${t}/${a}/${t}_hairs_${n}.png`),l(`character/adult/clothing/${t}/top/${t}_clothing_top_${i}.png`),l(`character/adult/clothing/${t}/bottom/${t}_clothing_bottom_${s}.png`),l(`character/adult/clothing/${t}/shoes/${t}_clothing_shoes_${r}.png`)];return h&&f.push(l(`character/adult/clothing/${t}/acessories/${t}_clothing_acessories_${h}.png`)),c==="keyboard"&&f.push(l("martin-garrido-cVUPic1cbd4-unsplash.png",{still:!0})),Promise.all(f)}const Et={idle:2,jump:6,run:4,walk:6},Lt=["black","caucasian","indian"],jt=["balding_gray","bigbun_black","bigbun_blonde","bigbun_brown_light","bigbun_brown_dark","bigbun_purple","bigbun_red","long_black","long_blonde","long_brown_dark","long_brown_light","long_purple","long_red","ponytail_black","ponytail_blonde","ponytail_brown_dark","ponytail_brown_light","ponytail_purple","ponytail_red","short_black","short_blonde","short_brown_dark","short_brown_light","short_brown_medium","short_purple","short_red","small_black","small_blonde","small_brown_dark","small_brown_light","small_purple","small_red","spikey_black","spikey_blonde","spikey_brown_dark","spikey_brown_light","spikey_purple","spikey_red"],It=[0,1,2,3];function Kt(o,t){return o===0?t<0?3:2:o>0?0:1}function C(o){return o[Math.floor(Math.random()*o.length)]}class Tt extends lt{constructor(){super(...arguments);u(this,"target");u(this,"markedForDeletion",!1);u(this,"speed",Rt([.1,.2,.3,.4,.5,.6]))}update(e,n){if(this.updateFrame(e,{idleStill:!0}),this.xmov=0,this.ymov=0,this.target){const i=this.target.x-this.pos.x,s=this.target.y-this.pos.y;i<2&&s<2?(delete this.target,this.xmov=0,this.ymov=0,this.state=z.idle):(this.xmov=Math.min(i,i>>-1|1),this.ymov=Math.min(s,s>>-1|1),this.move(e))}else Math.random()<.01&&(this.target=Vt(this.pos))}}function Vt({x:o,y:t}){return{x:o+Y(),y:t+Y()}}function Y(){const o=Math.random()*4-2;return Math.floor(o*Math.abs(o)**3)}function Rt(o){return o[Math.floor(Math.random()*o.length)]}function Ut(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ut={exports:{}},G={exports:{}};(function(o,t){t=o.exports=e,t.getSerialize=n;function e(i,s,r,h){return JSON.stringify(i,n(s,h),r)}function n(i,s){var r=[],h=[];return s==null&&(s=function(c,a){return r[0]===a?"[Circular ~]":"[Circular ~."+h.slice(0,r.indexOf(a)).join(".")+"]"}),function(c,a){if(r.length>0){var l=r.indexOf(this);~l?r.splice(l+1):r.push(this),~l?h.splice(l,1/0,c):h.push(c),~r.indexOf(a)&&(a=s.call(this,c,a))}else r.push(a);return i==null?a:i.call(this,c,a)}}})(G,G.exports);var qt=G.exports,Gt=function(){var o=4022871197,t=function(e){if(e){e=e.toString();for(var n=0;n<e.length;n++){o+=e.charCodeAt(n);var i=.02519603282416938*o;o=i>>>0,i-=o,i*=o,o=i>>>0,i-=o,o+=i*4294967296}return(o>>>0)*23283064365386963e-26}else o=4022871197};return t},H=function(o){return function(){var t=48,e=1,n=t,i=new Array(t),s,r,h=0,c=new Gt;for(s=0;s<t;s++)i[s]=c(Math.random());var a=function(){++n>=t&&(n=0);var d=1768863*i[n]+e*23283064365386963e-26;return i[n]=d-(e=d|0)},l=function(d){return Math.floor(d*(a()+(a()*2097152|0)*11102230246251565e-32))};l.string=function(d){var m,g="";for(m=0;m<d;m++)g+=String.fromCharCode(33+l(94));return g};var f=function(){var d=Array.prototype.slice.call(arguments);for(s=0;s<d.length;s++)for(r=0;r<t;r++)i[r]-=c(d[s]),i[r]<0&&(i[r]+=1)};return l.cleanString=function(d){return d=d.replace(/(^\s*)|(\s*$)/gi,""),d=d.replace(/[\x00-\x1F]/gi,""),d=d.replace(/\n /,`
`),d},l.hashString=function(d){for(d=l.cleanString(d),c(d),s=0;s<d.length;s++)for(h=d.charCodeAt(s),r=0;r<t;r++)i[r]-=c(h),i[r]<0&&(i[r]+=1)},l.seed=function(d){(typeof d>"u"||d===null)&&(d=Math.random()),typeof d!="string"&&(d=qt(d,function(m,g){return typeof g=="function"?g.toString():g})),l.initState(),l.hashString(d)},l.addEntropy=function(){var d=[];for(s=0;s<arguments.length;s++)d.push(arguments[s]);f(h+++new Date().getTime()+d.join("")+Math.random())},l.initState=function(){for(c(),s=0;s<t;s++)i[s]=c(" ");e=1,n=t},l.done=function(){c=null},typeof o<"u"&&l.seed(o),l.range=function(d){return l(d)},l.random=function(){return l(Number.MAX_VALUE-1)/Number.MAX_VALUE},l.floatBetween=function(d,m){return l.random()*(m-d)+d},l.intBetween=function(d,m){return Math.floor(l.random()*(m-d+1))+d},l}()};H.create=function(o){return new H(o)};var Ht=H;const Zt=Ht;class Bt{constructor(t){this.p=new Uint8Array(512),this.seed(t)}gen(){}seed(t){const e=Zt.create(t||Math.random());for(let n=0;n<256;n++)this.p[n]=n;for(let n=0;n<256;n++){const i=e(256),s=this.p[n];this.p[n]=this.p[i],this.p[i]=s}for(let n=0;n<256;n++)this.p[n+256]=this.p[n]}transform(t){return((...n)=>t.apply(this,n)).bind(this)}octavate(...t){const e=t[0],n=t.slice(1);let i=0,s=0;for(let r=0;r<e;r++){const h=1<<r;i+=this.gen.apply(this,n.map(c=>c*h))/h}for(let r=0;r<e;r++)s+=1/(1<<r);return i/s}}var O=Bt;class J{constructor(t){this.x=t}dot(t){return this.x*t}}const Q=[new J(1),new J(-1)];function Dt(o,t){return Q[o[t]%Q.length]}var ft={grad1:Dt};function pt(...o){const t=o.slice(1),e=o[0]-t.reduce((n,i)=>n+i*i,0);return e*e*e*e}function Wt(o,t,e){return o*(1-e)+t*e}function Xt(o){return o*o*o*(10+o*(-15+o*6))}const Yt=pt.bind(null,1),Jt=pt.bind(null,.5);var P={lerp:Wt,fade:Xt,cut1:Yt,cut:Jt};const Qt=O,{grad1:tt}=ft,{cut1:et}=P;class te extends Qt{gen(t){const e=Math.floor(t)%256,n=t-e,i=et(n)*tt(this.p,e).dot(n),s=et(n-1)*tt(this.p,e+1).dot(n-1);return .5*(i+s)}}var ee=te;class b{constructor(t,e){this.x=t,this.y=e}dot(t,e){return this.x*t+this.y*e}}const nt=[new b(1,0),new b(1,1),new b(0,1),new b(-1,1),new b(-1,0),new b(-1,-1),new b(0,-1),new b(1,-1)];function ne(o,t,e){const n=o[t+o[e]]%nt.length;return nt[n]}const se=.5*(Math.sqrt(3)-1),oe=(3-Math.sqrt(3))/6;var gt={grad2:ne,S2_TO_C:se,C_TO_S2:oe};const ie=O,{grad2:T,S2_TO_C:re,C_TO_S2:E}=gt,{cut:V}=P;class ae extends ie{gen(t,e){const n=(t+e)*re,i=Math.trunc(t+n),s=Math.trunc(e+n),r=(i+s)*E,h=i-r,c=s-r,a=t-h,l=e-c,f=a>l?1:0,d=a>l?0:1,m=a-f+E,g=l-d+E,M=a-1+2*E,k=l-1+2*E,_=V(a,l)*T(this.p,i,s).dot(a,l),F=V(m,g)*T(this.p,i+f,s+d).dot(m,g),K=V(M,k)*T(this.p,i+1,s+1).dot(M,k);return 70*(_+F+K)}}var ce=ae;const he=O,{grad1:st}=ft,{lerp:le,fade:de}=P;class ue extends he{gen(t){const e=Math.floor(t)%256,n=t-e,i=st(this.p,e).dot(n),s=st(this.p,e+1).dot(n-1);return le(i,s,de(n))}}var fe=ue;const pe=O,{grad2:j}=gt,{fade:R,lerp:U}=P;class ge extends pe{gen(t,e){const n=Math.trunc(t)%256,i=Math.trunc(e)%256,s=t-n,r=e-i,h=j(this.p,n,i).dot(s,r),c=j(this.p,n+1,i).dot(s-1,r),a=j(this.p,n,i+1).dot(s,r-1),l=j(this.p,n+1,i+1).dot(s-1,r-1);return U(U(h,c,R(s)),U(a,l,R(s)),R(r))}}var me=ge;class v{constructor(t,e,n){this.x=t,this.y=e,this.z=n}dot(t,e,n){return this.x*t+this.y*e+this.z*n}}const ot=[new v(1,1,1),new v(-1,1,1),new v(1,-1,1),new v(-1,-1,1),new v(1,1,0),new v(-1,1,0),new v(1,-1,0),new v(-1,-1,0),new v(1,1,-1),new v(-1,1,-1),new v(1,-1,-1),new v(-1,-1,-1)];function we(o,t,e,n){const i=o[t+o[e+o[n]]]%ot.length;return ot[i]}var ye={grad3:we};const xe=O,{grad3:$}=ye,{fade:q,lerp:S}=P;class ve extends xe{gen(t,e,n){const i=Math.trunc(t)%256,s=Math.trunc(e)%256,r=Math.trunc(n)%256,h=t-i,c=e-s,a=n-r,l=$(this.p,i,s,r).dot(h,c,a),f=$(this.p,i+1,s,r).dot(h-1,c,a),d=$(this.p,i,s+1,r).dot(h,c-1,a),m=$(this.p,i+1,s+1,r).dot(h-1,c-1,a),g=$(this.p,i,s,r+1).dot(h,c,a-1),M=$(this.p,i+1,s,r+1).dot(h-1,c,a-1),k=$(this.p,i,s+1,r+1).dot(h,c-1,a-1),_=$(this.p,i+1,s+1,r+1).dot(h-1,c-1,a-1);return S(S(S(l,f,h),S(d,m,h),q(c)),S(S(g,M,h),S(k,_,h),q(c)),q(a))}}var _e=ve;class p{constructor(t,e,n,i){this.x=t,this.y=e,this.z=n,this.t=i}dot(t,e,n,i){return this.x*t+this.y*e+this.z*n+this.t*i}}const it=[new p(0,1,1,1),new p(0,1,1,-1),new p(0,1,-1,1),new p(0,1,-1,-1),new p(0,-1,1,1),new p(0,-1,1,-1),new p(0,-1,-1,1),new p(0,-1,-1,-1),new p(1,0,1,1),new p(1,0,1,-1),new p(1,0,-1,1),new p(1,0,-1,-1),new p(-1,0,1,1),new p(-1,0,1,-1),new p(-1,0,-1,1),new p(-1,0,-1,-1),new p(1,1,0,1),new p(1,1,0,-1),new p(1,-1,0,1),new p(1,-1,0,-1),new p(-1,1,0,1),new p(-1,1,0,-1),new p(-1,-1,0,1),new p(-1,-1,0,-1),new p(1,1,1,0),new p(1,1,-1,0),new p(1,-1,1,0),new p(1,-1,-1,0),new p(-1,1,1,0),new p(-1,1,-1,0),new p(-1,-1,1,0),new p(-1,-1,-1,0)];function Me(o,t,e,n,i){const s=o[t+o[e+o[n+o[i]]]]%it.length;return it[s]}var ke={grad4:Me};const be=O,{grad4:w}=ke,{fade:A,lerp:y}=P;class $e extends be{gen(t,e,n,i){const s=Math.trunc(t)%256,r=Math.trunc(e)%256,h=Math.trunc(n)%256,c=Math.trunc(i)%256,a=t-s,l=e-r,f=n-h,d=i-c,m=w(this.p,s,r,h,c).dot(a,l,f,d),g=w(this.p,s+1,r,h,c).dot(a-1,l,f),M=w(this.p,s,r+1,h,c).dot(a,l-1,f),k=w(this.p,s+1,r+1,h,c).dot(a-1,l-1,f),_=w(this.p,s,r,h+1,c).dot(a,l,f-1),F=w(this.p,s+1,r,h+1,c).dot(a-1,l,f-1),K=w(this.p,s,r+1,h+1,c).dot(a,l-1,f-1),yt=w(this.p,s+1,r+1,h+1,c).dot(a-1,l-1,f-1),xt=w(this.p,s,r,h,c+1).dot(a,l,f,d-1),vt=w(this.p,s+1,r,h,c+1).dot(a-1,l,f,d-1),_t=w(this.p,s,r+1,h,c+1).dot(a,l-1,f,d-1),Mt=w(this.p,s+1,r+1,h,c+1).dot(a-1,l-1,f,d-1),kt=w(this.p,s,r,h+1,c+1).dot(a,l,f-1,d-1),bt=w(this.p,s+1,r,h+1,c+1).dot(a-1,l,f-1,d-1),$t=w(this.p,s,r+1,h+1,c+1).dot(a,l-1,f-1,d-1),zt=w(this.p,s+1,r+1,h+1,c+1).dot(a-1,l-1,f-1,d-1);return y(y(y(y(m,g,a),y(M,k,a),A(l)),y(y(_,F,a),y(K,yt,a),A(l)),A(f)),y(y(y(xt,vt,a),y(_t,Mt,a),A(l)),y(y(kt,bt,a),y($t,zt,a),A(l)),A(f)),A(d))}}var ze=$e;const{lerp:rt,fade:at}=P;function mt(o,t){return t.length===1?o[t[0]]:o[t[0]+mt(o,t.slice(1))]}class Ne{constructor(t){this.R=t}dot(t){let e=0;for(let n=0;n<t.length;n++)e+=this.R[n]*t[n];return e}}const I=[];function Se(o){for(let t=0;t<o*2;t++){const e=new Array(o).fill(0);e[t%o]=t/o>=1?1:-1,I[t]=new Ne(e)}}function Z(o,t){if(t.length===1)return rt(o[0],o[1],at(t[0]));const e=o.slice(0,Math.floor(o.length/2)),n=o.slice(Math.ceil(o.length/2));return rt(Z(e,t.slice(0,t.length-1)),Z(n,t.slice(0,t.length-1)),at(t[t.length-1]))}function Ae(o,t,e,n){const i=[];I.length===0&&Se(t);for(let s=0;s<2<<t-1;s++){const r=e.slice(),h=n.slice();let c=s;for(let a=0;a<t;a++)c&1&&(r[a]+=1,h[a]-=1),c=c>>1;i[s]=I[mt(o,r)%I.length].dot(h)}return i}var Oe={lerpN:Z,getNs:Ae};const Pe=O,{lerpN:Ce,getNs:Fe}=Oe;class Ee extends Pe{gen(...t){const e=[],n=[];for(let s=0;s<t.length;s++)e[s]=Math.trunc(t[s])%256,n[s]=t[s]-e[s];const i=Fe(this.p,t.length,e,n);return Ce(i,n)}}var Le=Ee;const je=ee,Ie=ce,Ke=fe,Te=me,Ve=_e,Re=ze,Ue=Le;var qe={Simplex1:je,Simplex2:Ie,Perlin1:Ke,Perlin2:Te,Perlin3:Ve,Perlin4:Re,PerlinN:Ue};(function(o){o.exports=qe})(ut);const Ge=Ut(ut.exports),He=new Ge.Perlin2("seed"),N=class{constructor({x:t,y:e},n){u(this,"stale",!1);u(this,"pos");u(this,"seed");u(this,"noise");u(this,"tiles");this.pos={x:t,y:e},this.seed=n,this.noise=Array(N.size**2).fill("").map((i,s)=>He.gen(Math.abs((2e3+t+s%N.size)/32),Math.abs((2e3+e+Math.floor(s/N.size))/32))),this.tiles=this.noise.map(i=>i<.15?"grass":i>.19?"water":"sand")}update(t,e){}draw(t,e){const{tile:n}=e.canvas,i=e.resolve(this.pos);for(let s=0;s<N.size**2;s++){const r=i.x+n*(s%N.size),h=i.y+n*Math.floor(s/N.size),c=this.tiles[s];if(e.debug)t.fillStyle=`hsl(${Math.floor(this.noise[s]*180+180)}, 100%, 50%)`,t.fillRect(r,h,n+1,n+1);else if(c==="grass")t.fillStyle="#83cd56",t.fillRect(r,h,n+1,n+1);else{const a={grass:{x:2,y:9},sand:{x:51,y:1},water:{x:1,y:9}}[c];t.drawImage(image_terrain,a.x*16,a.y*16,16,16,r,h,n+1,n+1)}}}};let x=N;u(x,"size",16);class Ze{constructor(t){u(this,"seed");u(this,"chunks",new Map);this.seed=t}update(t,e){this.loadUnloadChunks(e);for(const[,n]of this.chunks)n.update(t,e)}draw(t,e){for(const[,n]of this.chunks)n.draw(t,e)}loadUnloadChunks(t){const{min:e,max:n}=t;for(const[,c]of this.chunks)c.stale=!0;const i=Math.floor(e.x/x.size)*x.size,s=Math.floor(e.y/x.size)*x.size,r=Math.floor(n.x/x.size)*x.size,h=Math.floor(n.y/x.size)*x.size;for(let c=s;c<=h;c+=x.size)for(let a=i;a<=r;a+=x.size){const l=`${a}:${c}`,f=this.chunks.get(l);f?f.stale=!1:this.chunks.set(l,new x({x:a,y:c},this.seed))}for(const[c,a]of this.chunks)a.stale&&this.chunks.delete(c)}}class Be{constructor(t,e){u(this,"input",new At);u(this,"player");u(this,"tiles");u(this,"viewport");u(this,"npcs",new Set);this.viewport=t,this.player=e,this.tiles=new Ze(1337),window.game=this}update(t){const{input:e,viewport:n}=this;this.viewport.update(t,e),this.tiles.update(t,n),this.player.update(t,n,e),Math.random()<.2&&this.npcs.size<30&&this.npcs.add(new Tt({x:this.player.pos.x+Math.floor(Math.random()*100-50),y:this.player.pos.y+Math.floor(Math.random()*100-50)}));for(const i of this.npcs)i.update(t,n),De(i,this.player)>100&&this.npcs.delete(i)}draw(t){const{viewport:e}=this,{width:n,height:i,mid:s}=e.canvas,r=Math.min(n,i),h=r/3;this.tiles.draw(t,e),this.player.draw(t,e);for(const a of this.npcs)a.draw(t,e);const c=t.createRadialGradient(s.x,s.y,h,s.x,s.y,r);c.addColorStop(.9,"rgba(0, 0, 0, 0.3)"),c.addColorStop(.4,"transparent"),t.fillStyle=c,t.fillRect(0,0,n,i)}}function De(o,t){return Math.hypot(o.pos.y-t.pos.y,o.pos.x-t.pos.x)}const L=["field_theme_1.wav","field_theme_2.wav","night_theme_1.wav"],wt=new Map;for(const o of L)wt.set(o,new Audio);let B=new AudioContext,We=B.createGain();class Xe{constructor(){u(this,"trackName",L[0])}play(){const t=wt.get(this.trackName);t.src||(t.src=`/music/${this.trackName}`,t.loop=!0),t.play(),B.createMediaElementSource(t).connect(We).connect(B.destination),setTimeout(()=>{t.pause(),this.trackName=L[(L.indexOf(this.trackName)+1)%L.length],this.play()},25e3)}}class Ye extends lt{constructor({x:e,y:n}){super({x:e,y:n});u(this,"speed",1);this.tool="keyboard"}update(e,n,i){if(this.updateFrame(e),i){const{up:s,left:r,down:h,right:c}=i.keys;this.xmov=r&&!c?-1:!r&&c?1:0,this.ymov=s&&!h?-1:!s&&h?1:0;const a=n.gameMode==="god"?20:1;this.move(e,a)}else this.xmov=0,this.ymov=0}}const ct=window.devicePixelRatio,ht={normal:{min:.4,max:6,start:1,speed:.05},god:{min:.4,max:20,start:20,speed:.08}};class Je{constructor(t,e){u(this,"zoom",1);u(this,"gameMode","normal");u(this,"debug",!1);u(this,"offset",{x:0,y:0});u(this,"size",{width:0,height:0});u(this,"ratio",1);u(this,"canvas",{width:innerWidth,height:innerHeight,tile:80,mid:{x:innerWidth/2,y:innerHeight/2}});u(this,"ctx");u(this,"target");u(this,"_resize",()=>{this.ctx.canvas.style.width=`${innerWidth}px`,this.ctx.canvas.style.height=`${innerHeight-7}px`,this.canvas.width=this.ctx.canvas.width=ct*innerWidth,this.canvas.height=this.ctx.canvas.height=ct*(innerHeight-7),this.canvas.mid={x:this.canvas.width/2,y:this.canvas.height/2},this.canvas.tile=this.canvas.width/this.size.width,this.ratio=this.ctx.canvas.width/this.ctx.canvas.height,this.ctx.imageSmoothingEnabled=!1,this._updateZoom(this.zoom)});this.ctx=t,this.target=e,addEventListener("resize",this._resize),this._resize(),this._updateZoom(this.zoom)}update(t,e){if(e.keys.space){const{min:n,max:i,speed:s}=ht[this.gameMode],r=1+(e.keys.shift?-s:s);this._updateZoom(Math.max(n,Math.min(i,this.zoom*r)))}}resolve(t){const e=(t.x-this.min.x)*this.canvas.tile,n=(t.y-this.min.y)*this.canvas.tile;return{x:e,y:n}}get min(){const t=this.target.pos,{width:e,height:n}=this.size,{offset:i}=this,s=t.x+i.x-e/2,r=t.y+i.y-n/2;return{x:s,y:r}}get max(){const t=this.target.pos,{width:e,height:n}=this.size,{offset:i}=this,s=t.x+i.x+e/2,r=t.y+i.y+n/2;return{x:s,y:r}}_updateZoom(t){this.zoom=t;const e=100*this.zoom**2,n=Math.sqrt(e*this.ratio);this.size={width:n,height:e/n},this.canvas.tile=this.canvas.width/n}toggleGameMode(){this.gameMode==="normal"?this.gameMode="god":this.gameMode="normal",this.zoom=ht[this.gameMode].start,this._updateZoom(this.zoom)}}function Qe(){const o=canvas.getContext("2d");if(!o)throw new Error("Failed to get context");const t=new Ye({x:0,y:0}),e=new Je(o,t),n=new Be(e,t);new Xe().play();let s=0,r=0;function h(c){const a=c-r;r=c,o.clearRect(0,0,canvas.width,canvas.height),n.draw(o),n.update(a),s=requestAnimationFrame(h)}cancelAnimationFrame(s),s=requestAnimationFrame(h),toggle.addEventListener("click",()=>{e.toggleGameMode(),toggle.blur()}),addEventListener("keydown",c=>{c.key==="d"&&(e.debug=!e.debug)})}Qe();
