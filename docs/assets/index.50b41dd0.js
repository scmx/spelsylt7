var kt=Object.defineProperty;var $t=(i,t,e)=>t in i?kt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var u=(i,t,e)=>($t(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();class zt{constructor(){u(this,"keys",{...B});u(this,"onKeydown",t=>{for(const[e,n]of D)n.has(t.code)&&(this.keys[e]=!0)});u(this,"onKeyup",t=>{for(const[e,n]of D)n.has(t.code)&&(this.keys[e]=!1)});u(this,"onBlur",()=>{this.keys={...B}});addEventListener("keydown",this.onKeydown),addEventListener("keyup",this.onKeyup),addEventListener("blur",this.onBlur)}}const B={up:!1,left:!1,down:!1,right:!1,space:!1,shift:!1},D=new Map([["up",new Set(["ArrowUp","KeyW"])],["left",new Set(["ArrowLeft","KeyA"])],["down",new Set(["ArrowDown","KeyS"])],["right",new Set(["ArrowRight","KeyD"])],["space",new Set(["Space"])],["shift",new Set(["ShiftLeft","ShiftRight"])]]);class ct{constructor({x:t,y:e}){u(this,"state",z.idle);u(this,"skin",C(Ct));u(this,"hair",C(Ft));u(this,"facing",C(Lt));u(this,"top",C(St));u(this,"bottom",C(Nt));u(this,"shoes",C(At));u(this,"frame",{x:0,timer:0,interval:1e3/8});u(this,"images",[]);u(this,"speed",1);u(this,"xmov",0);u(this,"ymov",0);u(this,"pos");u(this,"accessory");u(this,"tool");this.pos={x:t,y:e},Math.random()<.2&&(this.accessory=ht.tie_red),this.loadImages()}update(t,e){this.updateFrame(t)}updateFrame(t,{idleStill:e}={}){this.frame.timer<this.frame.interval?this.frame.timer+=t:(this.frame.timer=0,this.frame.x=e&&this.state===z.idle?0:(this.frame.x+1)%Ot[this.state])}move(t,e=this.speed){if(this.xmov||this.ymov){const n=Math.atan2(this.ymov,this.xmov);this.state=e>.5?z.run:z.walk,this.facing=Et(this.xmov,this.ymov),this.pos.x+=Math.cos(n)*e*t*.003,this.pos.y+=Math.sin(n)*e*t*.003}else this.state!==z.idle&&(this.state=z.idle,this.frame.x=0);this.loadImages()}draw(t,e){const{tile:n}=e.canvas,o=e.resolve(this.pos),{frame:s}=this,r=n*4,h=r/2,c=r/8;for(const a of this.images)a.dataset.still?t.drawImage(a,o.x,o.y,c,c):t.drawImage(a,s.x*64,this.facing*64,64,64,o.x-h,o.y-h,r,r)}loadImages(){Pt(this).then(t=>{this.images=t})}getSprite(){const{x:t,y:e}=this.pos,n=32;return{min:{x:t-n,y:e-n},max:{x:t+n,y:e+n}}}}var z=(i=>(i.idle="idle",i.jump="jump",i.run="run",i.walk="walk",i))(z||{}),ht=(i=>(i.tie_red="tie_red",i))(ht||{});const St=["overhalls","shirt_green","shirt_white"],Nt=["jeans","khakis"],At=["black","brown","red","yellow"],G=new Map;async function Pt(i){const{state:t,skin:e,hair:n,top:o,bottom:s,shoes:r,accessory:h,tool:c}=i,a=n.split("_")[0];async function l(d,m={}){let g=G.get(d);return g||(g=new Promise((M,b)=>{const _=new Image;_.src=`/spelsylt7/assets/${d}`,_.onload=()=>M(_),_.onerror=F=>{console.error(m);debugger;b(F)},m.still&&(_.dataset.still="1")}),G.set(d,g),g)}const f=[l(`character/adult/body/${t}/${t}_${e}_skintone.png`),l(`character/adult/hairs/${t}/${a}/${t}_hairs_${n}.png`),l(`character/adult/clothing/${t}/top/${t}_clothing_top_${o}.png`),l(`character/adult/clothing/${t}/bottom/${t}_clothing_bottom_${s}.png`),l(`character/adult/clothing/${t}/shoes/${t}_clothing_shoes_${r}.png`)];return h&&f.push(l(`character/adult/clothing/${t}/acessories/${t}_clothing_acessories_${h}.png`)),c==="keyboard"&&f.push(l("martin-garrido-cVUPic1cbd4-unsplash.png",{still:!0})),Promise.all(f)}const Ot={idle:2,jump:6,run:4,walk:6},Ct=["black","caucasian","indian"],Ft=["balding_gray","bigbun_black","bigbun_blonde","bigbun_brown_light","bigbun_brown_dark","bigbun_purple","bigbun_red","long_black","long_blonde","long_brown_dark","long_brown_light","long_purple","long_red","ponytail_black","ponytail_blonde","ponytail_brown_dark","ponytail_brown_light","ponytail_purple","ponytail_red","short_black","short_blonde","short_brown_dark","short_brown_light","short_brown_medium","short_purple","short_red","small_black","small_blonde","small_brown_dark","small_brown_light","small_purple","small_red","spikey_black","spikey_blonde","spikey_brown_dark","spikey_brown_light","spikey_purple","spikey_red"],Lt=[0,1,2,3];function Et(i,t){return i===0?t<0?3:2:i>0?0:1}function C(i){return i[Math.floor(Math.random()*i.length)]}class jt extends ct{constructor(){super(...arguments);u(this,"target");u(this,"markedForDeletion",!1);u(this,"speed",Kt([.1,.2,.3,.4,.5,.6]))}update(e,n){if(this.updateFrame(e,{idleStill:!0}),this.xmov=0,this.ymov=0,this.target){const o=this.target.x-this.pos.x,s=this.target.y-this.pos.y;o<2&&s<2?(delete this.target,this.xmov=0,this.ymov=0,this.state=z.idle):(this.xmov=Math.min(o,o>>-1|1),this.ymov=Math.min(s,s>>-1|1),this.move(e))}else Math.random()<.01&&(this.target=It(this.pos))}}function It({x:i,y:t}){return{x:i+W(),y:t+W()}}function W(){const i=Math.random()*4-2;return Math.floor(i*Math.abs(i)**3)}function Kt(i){return i[Math.floor(Math.random()*i.length)]}function Vt(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lt={exports:{}},H={exports:{}};(function(i,t){t=i.exports=e,t.getSerialize=n;function e(o,s,r,h){return JSON.stringify(o,n(s,h),r)}function n(o,s){var r=[],h=[];return s==null&&(s=function(c,a){return r[0]===a?"[Circular ~]":"[Circular ~."+h.slice(0,r.indexOf(a)).join(".")+"]"}),function(c,a){if(r.length>0){var l=r.indexOf(this);~l?r.splice(l+1):r.push(this),~l?h.splice(l,1/0,c):h.push(c),~r.indexOf(a)&&(a=s.call(this,c,a))}else r.push(a);return o==null?a:o.call(this,c,a)}}})(H,H.exports);var Tt=H.exports,Ut=function(){var i=4022871197,t=function(e){if(e){e=e.toString();for(var n=0;n<e.length;n++){i+=e.charCodeAt(n);var o=.02519603282416938*i;i=o>>>0,o-=i,o*=i,i=o>>>0,o-=i,i+=o*4294967296}return(i>>>0)*23283064365386963e-26}else i=4022871197};return t},R=function(i){return function(){var t=48,e=1,n=t,o=new Array(t),s,r,h=0,c=new Ut;for(s=0;s<t;s++)o[s]=c(Math.random());var a=function(){++n>=t&&(n=0);var d=1768863*o[n]+e*23283064365386963e-26;return o[n]=d-(e=d|0)},l=function(d){return Math.floor(d*(a()+(a()*2097152|0)*11102230246251565e-32))};l.string=function(d){var m,g="";for(m=0;m<d;m++)g+=String.fromCharCode(33+l(94));return g};var f=function(){var d=Array.prototype.slice.call(arguments);for(s=0;s<d.length;s++)for(r=0;r<t;r++)o[r]-=c(d[s]),o[r]<0&&(o[r]+=1)};return l.cleanString=function(d){return d=d.replace(/(^\s*)|(\s*$)/gi,""),d=d.replace(/[\x00-\x1F]/gi,""),d=d.replace(/\n /,`
`),d},l.hashString=function(d){for(d=l.cleanString(d),c(d),s=0;s<d.length;s++)for(h=d.charCodeAt(s),r=0;r<t;r++)o[r]-=c(h),o[r]<0&&(o[r]+=1)},l.seed=function(d){(typeof d>"u"||d===null)&&(d=Math.random()),typeof d!="string"&&(d=Tt(d,function(m,g){return typeof g=="function"?g.toString():g})),l.initState(),l.hashString(d)},l.addEntropy=function(){var d=[];for(s=0;s<arguments.length;s++)d.push(arguments[s]);f(h+++new Date().getTime()+d.join("")+Math.random())},l.initState=function(){for(c(),s=0;s<t;s++)o[s]=c(" ");e=1,n=t},l.done=function(){c=null},typeof i<"u"&&l.seed(i),l.range=function(d){return l(d)},l.random=function(){return l(Number.MAX_VALUE-1)/Number.MAX_VALUE},l.floatBetween=function(d,m){return l.random()*(m-d)+d},l.intBetween=function(d,m){return Math.floor(l.random()*(m-d+1))+d},l}()};R.create=function(i){return new R(i)};var qt=R;const Ht=qt;class Rt{constructor(t){this.p=new Uint8Array(512),this.seed(t)}gen(){}seed(t){const e=Ht.create(t||Math.random());for(let n=0;n<256;n++)this.p[n]=n;for(let n=0;n<256;n++){const o=e(256),s=this.p[n];this.p[n]=this.p[o],this.p[o]=s}for(let n=0;n<256;n++)this.p[n+256]=this.p[n]}transform(t){return((...n)=>t.apply(this,n)).bind(this)}octavate(...t){const e=t[0],n=t.slice(1);let o=0,s=0;for(let r=0;r<e;r++){const h=1<<r;o+=this.gen.apply(this,n.map(c=>c*h))/h}for(let r=0;r<e;r++)s+=1/(1<<r);return o/s}}var P=Rt;class X{constructor(t){this.x=t}dot(t){return this.x*t}}const Y=[new X(1),new X(-1)];function Zt(i,t){return Y[i[t]%Y.length]}var dt={grad1:Zt};function ut(...i){const t=i.slice(1),e=i[0]-t.reduce((n,o)=>n+o*o,0);return e*e*e*e}function Bt(i,t,e){return i*(1-e)+t*e}function Dt(i){return i*i*i*(10+i*(-15+i*6))}const Gt=ut.bind(null,1),Wt=ut.bind(null,.5);var O={lerp:Bt,fade:Dt,cut1:Gt,cut:Wt};const Xt=P,{grad1:J}=dt,{cut1:Q}=O;class Yt extends Xt{gen(t){const e=Math.floor(t)%256,n=t-e,o=Q(n)*J(this.p,e).dot(n),s=Q(n-1)*J(this.p,e+1).dot(n-1);return .5*(o+s)}}var Jt=Yt;class k{constructor(t,e){this.x=t,this.y=e}dot(t,e){return this.x*t+this.y*e}}const tt=[new k(1,0),new k(1,1),new k(0,1),new k(-1,1),new k(-1,0),new k(-1,-1),new k(0,-1),new k(1,-1)];function Qt(i,t,e){const n=i[t+i[e]]%tt.length;return tt[n]}const te=.5*(Math.sqrt(3)-1),ee=(3-Math.sqrt(3))/6;var ft={grad2:Qt,S2_TO_C:te,C_TO_S2:ee};const ne=P,{grad2:K,S2_TO_C:se,C_TO_S2:L}=ft,{cut:V}=O;class oe extends ne{gen(t,e){const n=(t+e)*se,o=Math.trunc(t+n),s=Math.trunc(e+n),r=(o+s)*L,h=o-r,c=s-r,a=t-h,l=e-c,f=a>l?1:0,d=a>l?0:1,m=a-f+L,g=l-d+L,M=a-1+2*L,b=l-1+2*L,_=V(a,l)*K(this.p,o,s).dot(a,l),F=V(m,g)*K(this.p,o+f,s+d).dot(m,g),I=V(M,b)*K(this.p,o+1,s+1).dot(M,b);return 70*(_+F+I)}}var ie=oe;const re=P,{grad1:et}=dt,{lerp:ae,fade:ce}=O;class he extends re{gen(t){const e=Math.floor(t)%256,n=t-e,o=et(this.p,e).dot(n),s=et(this.p,e+1).dot(n-1);return ae(o,s,ce(n))}}var le=he;const de=P,{grad2:E}=ft,{fade:T,lerp:U}=O;class ue extends de{gen(t,e){const n=Math.trunc(t)%256,o=Math.trunc(e)%256,s=t-n,r=e-o,h=E(this.p,n,o).dot(s,r),c=E(this.p,n+1,o).dot(s-1,r),a=E(this.p,n,o+1).dot(s,r-1),l=E(this.p,n+1,o+1).dot(s-1,r-1);return U(U(h,c,T(s)),U(a,l,T(s)),T(r))}}var fe=ue;class x{constructor(t,e,n){this.x=t,this.y=e,this.z=n}dot(t,e,n){return this.x*t+this.y*e+this.z*n}}const nt=[new x(1,1,1),new x(-1,1,1),new x(1,-1,1),new x(-1,-1,1),new x(1,1,0),new x(-1,1,0),new x(1,-1,0),new x(-1,-1,0),new x(1,1,-1),new x(-1,1,-1),new x(1,-1,-1),new x(-1,-1,-1)];function pe(i,t,e,n){const o=i[t+i[e+i[n]]]%nt.length;return nt[o]}var ge={grad3:pe};const me=P,{grad3:$}=ge,{fade:q,lerp:N}=O;class we extends me{gen(t,e,n){const o=Math.trunc(t)%256,s=Math.trunc(e)%256,r=Math.trunc(n)%256,h=t-o,c=e-s,a=n-r,l=$(this.p,o,s,r).dot(h,c,a),f=$(this.p,o+1,s,r).dot(h-1,c,a),d=$(this.p,o,s+1,r).dot(h,c-1,a),m=$(this.p,o+1,s+1,r).dot(h-1,c-1,a),g=$(this.p,o,s,r+1).dot(h,c,a-1),M=$(this.p,o+1,s,r+1).dot(h-1,c,a-1),b=$(this.p,o,s+1,r+1).dot(h,c-1,a-1),_=$(this.p,o+1,s+1,r+1).dot(h-1,c-1,a-1);return N(N(N(l,f,h),N(d,m,h),q(c)),N(N(g,M,h),N(b,_,h),q(c)),q(a))}}var ye=we;class p{constructor(t,e,n,o){this.x=t,this.y=e,this.z=n,this.t=o}dot(t,e,n,o){return this.x*t+this.y*e+this.z*n+this.t*o}}const st=[new p(0,1,1,1),new p(0,1,1,-1),new p(0,1,-1,1),new p(0,1,-1,-1),new p(0,-1,1,1),new p(0,-1,1,-1),new p(0,-1,-1,1),new p(0,-1,-1,-1),new p(1,0,1,1),new p(1,0,1,-1),new p(1,0,-1,1),new p(1,0,-1,-1),new p(-1,0,1,1),new p(-1,0,1,-1),new p(-1,0,-1,1),new p(-1,0,-1,-1),new p(1,1,0,1),new p(1,1,0,-1),new p(1,-1,0,1),new p(1,-1,0,-1),new p(-1,1,0,1),new p(-1,1,0,-1),new p(-1,-1,0,1),new p(-1,-1,0,-1),new p(1,1,1,0),new p(1,1,-1,0),new p(1,-1,1,0),new p(1,-1,-1,0),new p(-1,1,1,0),new p(-1,1,-1,0),new p(-1,-1,1,0),new p(-1,-1,-1,0)];function ve(i,t,e,n,o){const s=i[t+i[e+i[n+i[o]]]]%st.length;return st[s]}var xe={grad4:ve};const _e=P,{grad4:w}=xe,{fade:A,lerp:y}=O;class Me extends _e{gen(t,e,n,o){const s=Math.trunc(t)%256,r=Math.trunc(e)%256,h=Math.trunc(n)%256,c=Math.trunc(o)%256,a=t-s,l=e-r,f=n-h,d=o-c,m=w(this.p,s,r,h,c).dot(a,l,f,d),g=w(this.p,s+1,r,h,c).dot(a-1,l,f),M=w(this.p,s,r+1,h,c).dot(a,l-1,f),b=w(this.p,s+1,r+1,h,c).dot(a-1,l-1,f),_=w(this.p,s,r,h+1,c).dot(a,l,f-1),F=w(this.p,s+1,r,h+1,c).dot(a-1,l,f-1),I=w(this.p,s,r+1,h+1,c).dot(a,l-1,f-1),gt=w(this.p,s+1,r+1,h+1,c).dot(a-1,l-1,f-1),mt=w(this.p,s,r,h,c+1).dot(a,l,f,d-1),wt=w(this.p,s+1,r,h,c+1).dot(a-1,l,f,d-1),yt=w(this.p,s,r+1,h,c+1).dot(a,l-1,f,d-1),vt=w(this.p,s+1,r+1,h,c+1).dot(a-1,l-1,f,d-1),xt=w(this.p,s,r,h+1,c+1).dot(a,l,f-1,d-1),_t=w(this.p,s+1,r,h+1,c+1).dot(a-1,l,f-1,d-1),Mt=w(this.p,s,r+1,h+1,c+1).dot(a,l-1,f-1,d-1),bt=w(this.p,s+1,r+1,h+1,c+1).dot(a-1,l-1,f-1,d-1);return y(y(y(y(m,g,a),y(M,b,a),A(l)),y(y(_,F,a),y(I,gt,a),A(l)),A(f)),y(y(y(mt,wt,a),y(yt,vt,a),A(l)),y(y(xt,_t,a),y(Mt,bt,a),A(l)),A(f)),A(d))}}var be=Me;const{lerp:ot,fade:it}=O;function pt(i,t){return t.length===1?i[t[0]]:i[t[0]+pt(i,t.slice(1))]}class ke{constructor(t){this.R=t}dot(t){let e=0;for(let n=0;n<t.length;n++)e+=this.R[n]*t[n];return e}}const j=[];function $e(i){for(let t=0;t<i*2;t++){const e=new Array(i).fill(0);e[t%i]=t/i>=1?1:-1,j[t]=new ke(e)}}function Z(i,t){if(t.length===1)return ot(i[0],i[1],it(t[0]));const e=i.slice(0,Math.floor(i.length/2)),n=i.slice(Math.ceil(i.length/2));return ot(Z(e,t.slice(0,t.length-1)),Z(n,t.slice(0,t.length-1)),it(t[t.length-1]))}function ze(i,t,e,n){const o=[];j.length===0&&$e(t);for(let s=0;s<2<<t-1;s++){const r=e.slice(),h=n.slice();let c=s;for(let a=0;a<t;a++)c&1&&(r[a]+=1,h[a]-=1),c=c>>1;o[s]=j[pt(i,r)%j.length].dot(h)}return o}var Se={lerpN:Z,getNs:ze};const Ne=P,{lerpN:Ae,getNs:Pe}=Se;class Oe extends Ne{gen(...t){const e=[],n=[];for(let s=0;s<t.length;s++)e[s]=Math.trunc(t[s])%256,n[s]=t[s]-e[s];const o=Pe(this.p,t.length,e,n);return Ae(o,n)}}var Ce=Oe;const Fe=Jt,Le=ie,Ee=le,je=fe,Ie=ye,Ke=be,Ve=Ce;var Te={Simplex1:Fe,Simplex2:Le,Perlin1:Ee,Perlin2:je,Perlin3:Ie,Perlin4:Ke,PerlinN:Ve};(function(i){i.exports=Te})(lt);const Ue=Vt(lt.exports),qe=new Ue.Perlin2("seed"),S=class{constructor({x:t,y:e},n){u(this,"stale",!1);u(this,"pos");u(this,"seed");u(this,"noise");u(this,"tiles");this.pos={x:t,y:e},this.seed=n,this.noise=Array(S.size**2).fill("").map((o,s)=>qe.gen(Math.abs((2e3+t+s%S.size)/32),Math.abs((2e3+e+Math.floor(s/S.size))/32))),this.tiles=this.noise.map(o=>o<.15?"grass":o>.19?"water":"sand")}update(t,e){}draw(t,e){const{tile:n}=e.canvas,o=e.resolve(this.pos);for(let s=0;s<S.size**2;s++){const r=o.x+n*(s%S.size),h=o.y+n*Math.floor(s/S.size);if(e.debug)t.fillStyle=`hsl(${Math.floor(this.noise[s]*180+180)}, 100%, 50%)`;else{const c=this.tiles[s];t.fillStyle={grass:"green",sand:"yellow",water:"blue"}[c]}t.fillRect(r,h,n+1,n+1)}}};let v=S;u(v,"size",16);class He{constructor(t){u(this,"seed");u(this,"chunks",new Map);this.seed=t}update(t,e){this.loadUnloadChunks(e);for(const[,n]of this.chunks)n.update(t,e)}draw(t,e){for(const[,n]of this.chunks)n.draw(t,e)}loadUnloadChunks(t){const{min:e,max:n}=t;for(const[,c]of this.chunks)c.stale=!0;const o=Math.floor(e.x/v.size)*v.size,s=Math.floor(e.y/v.size)*v.size,r=Math.floor(n.x/v.size)*v.size,h=Math.floor(n.y/v.size)*v.size;for(let c=s;c<=h;c+=v.size)for(let a=o;a<=r;a+=v.size){const l=`${a}:${c}`,f=this.chunks.get(l);f?f.stale=!1:this.chunks.set(l,new v({x:a,y:c},this.seed))}for(const[c,a]of this.chunks)a.stale&&this.chunks.delete(c)}}class Re{constructor(t,e){u(this,"input",new zt);u(this,"player");u(this,"tiles");u(this,"viewport");u(this,"npcs",new Set);this.viewport=t,this.player=e,this.tiles=new He(1337),window.game=this}update(t){const{input:e,viewport:n}=this;this.viewport.update(t,e),this.tiles.update(t,n),this.player.update(t,n,e),Math.random()<.2&&this.npcs.size<300&&this.npcs.add(new jt({x:this.player.pos.x+Math.floor(Math.random()*20-10),y:this.player.pos.y+Math.floor(Math.random()*20-10)}));for(const o of this.npcs)o.update(t,n),Ze(o,this.player)>20&&this.npcs.delete(o)}draw(t){const{viewport:e}=this,{width:n,height:o,mid:s}=e.canvas,r=Math.min(n,o),h=r/3;this.tiles.draw(t,e),this.player.draw(t,e);for(const a of this.npcs)a.draw(t,e);const c=t.createRadialGradient(s.x,s.y,h,s.x,s.y,r);c.addColorStop(.9,"rgba(0, 0, 0, 0.3)"),c.addColorStop(.4,"transparent"),t.fillStyle=c,t.fillRect(0,0,n,o)}}function Ze(i,t){return Math.hypot(i.pos.y-t.pos.y,i.pos.x-t.pos.x)}class Be extends ct{constructor({x:e,y:n}){super({x:e,y:n});u(this,"speed",1);this.tool="keyboard"}update(e,n,o){if(this.updateFrame(e),o){const{up:s,left:r,down:h,right:c}=o.keys;this.xmov=r&&!c?-1:!r&&c?1:0,this.ymov=s&&!h?-1:!s&&h?1:0;const a=n.gameMode==="god"?20:1;this.move(e,a)}else this.xmov=0,this.ymov=0}}const rt=window.devicePixelRatio,at={normal:{min:.4,max:6,start:1,speed:.05},god:{min:.4,max:20,start:20,speed:.08}};class De{constructor(t,e){u(this,"zoom",1);u(this,"gameMode","normal");u(this,"debug",!1);u(this,"offset",{x:0,y:0});u(this,"size",{width:0,height:0});u(this,"ratio",1);u(this,"canvas",{width:innerWidth,height:innerHeight,tile:80,mid:{x:innerWidth/2,y:innerHeight/2}});u(this,"ctx");u(this,"target");u(this,"_resize",()=>{this.ctx.canvas.style.width=`${innerWidth}px`,this.ctx.canvas.style.height=`${innerHeight-7}px`,this.canvas.width=this.ctx.canvas.width=rt*innerWidth,this.canvas.height=this.ctx.canvas.height=rt*(innerHeight-7),this.canvas.mid={x:this.canvas.width/2,y:this.canvas.height/2},this.canvas.tile=this.canvas.width/this.size.width,this.ratio=this.ctx.canvas.width/this.ctx.canvas.height,this.ctx.imageSmoothingEnabled=!1,this._updateZoom(this.zoom)});this.ctx=t,this.target=e,addEventListener("resize",this._resize),this._resize(),this._updateZoom(this.zoom)}update(t,e){if(e.keys.space){const{min:n,max:o,speed:s}=at[this.gameMode],r=1+(e.keys.shift?-s:s);this._updateZoom(Math.max(n,Math.min(o,this.zoom*r)))}}resolve(t){const e=(t.x-this.min.x)*this.canvas.tile,n=(t.y-this.min.y)*this.canvas.tile;return{x:e,y:n}}get min(){const t=this.target.pos,{width:e,height:n}=this.size,{offset:o}=this,s=t.x+o.x-e/2,r=t.y+o.y-n/2;return{x:s,y:r}}get max(){const t=this.target.pos,{width:e,height:n}=this.size,{offset:o}=this,s=t.x+o.x+e/2,r=t.y+o.y+n/2;return{x:s,y:r}}_updateZoom(t){this.zoom=t;const e=100*this.zoom**2,n=Math.sqrt(e*this.ratio);this.size={width:n,height:e/n},this.canvas.tile=this.canvas.width/n}toggleGameMode(){this.gameMode==="normal"?this.gameMode="god":this.gameMode="normal",this.zoom=at[this.gameMode].start,this._updateZoom(this.zoom)}}function Ge(){const i=canvas.getContext("2d");if(!i)throw new Error("Failed to get context");const t=new Be({x:0,y:0}),e=new De(i,t),n=new Re(e,t);let o=0,s=0;function r(h){const c=h-s;s=h,i.clearRect(0,0,canvas.width,canvas.height),n.draw(i),n.update(c),o=requestAnimationFrame(r)}cancelAnimationFrame(o),o=requestAnimationFrame(r),toggle.addEventListener("click",()=>{e.toggleGameMode(),toggle.blur()}),addEventListener("keydown",h=>{h.key==="d"&&(e.debug=!e.debug)})}Ge();
